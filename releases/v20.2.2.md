---
title: What&#39;s New in 20.2.2
toc: true
summary: Additions and changes in CockroachDB version 20.2.2 since version v20.2.1
---

## November 23, 2020

Get future release notes emailed to you:

<div class="hubspot-install-form install-form-1 clearfix">
    <script>
        hbspt.forms.create({
            css: '',
            cssClass: 'install-form',
            portalId: '1753393',
            formId: '39686297-81d2-45e7-a73f-55a596a8d5ff',
            formInstanceId: 1,
            target: '.install-form-1'
        });
    </script>
</div>

### Downloads

<div id="os-tabs" class="clearfix">
    <a href="https://binaries.cockroachdb.com/cockroach-20.2.2.darwin-10.9-amd64.tgz"><button id="mac" data-eventcategory="mac-binary-release-notes">Mac</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-20.2.2.linux-amd64.tgz"><button id="linux" data-eventcategory="linux-binary-release-notes">Linux</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-20.2.2.windows-6.2-amd64.zip"><button id="windows" data-eventcategory="windows-binary-release-notes">Windows</button></a>
    <a href="https://binaries.cockroachdb.com/cockroach-20.2.2.src.tgz"><button id="source" data-eventcategory="source-release-notes">Source</button></a>
</div>

### Docker image

{% include copy-clipboard.html %}
~~~shell
docker pull cockroachdb/cockroach-stable:20.2.2
~~~

### Security updates

- CockroachDB no longer reports the use of expired or invalid web auth cookies in the log file by default. [#55298][#55298]
- Updated the state validation for the OIDC login flow and replaced it with a stateless hash validation of the state parameter with the browser cookie using HMAC. [#56502][#56502]

### Enterprise edition changes

- The `insecure_tls_skip_verify` query string parameter may now be set on [changefeed](../v20.2/stream-data-out-of-cockroachdb-using-changefeeds.html) sinks. This disables client-side validation of responses and should be avoided if possible since it creates man-in-the-middle vulnerabilities unless combined with another method of authentication. [#56338][#56338]

### SQL language changes

- Updated the `TransactionRetryWithProtoRefreshError` to include a `HINT` field that links to [a web page containing useful information to resolve the error](../v20.2/transaction-retry-error-reference.html). [#56049][#56049]
- Parsing [intervals](../v20.2/interval.html) with fractional years now produces intervals with no more precision than months, to match the behavior of Postgres. [#56158][#56158]
- The `pg_attribute.atttypmod` column in the `pg_catalog` is now populated for [collated string types](../v20.2/collate.html). This also populates the value of the `TypeModifier` in the `RowDescription` message of the [pgwire protocol](https://www.postgresql.org/docs/current/static/protocol.html). [#55154][#55154]
- Add an option to [scheduled backups](../v20.2/manage-a-backup-schedule.html) to maintain a timeseries metric for last backed up timestamp. [#54987][#54987]
- Added an [`owner`](../v20.2/owner-to.html) column to the following statements: [`SHOW DATABASES`](../v20.2/show-databases.html), [`SHOW ENUMS`](../v20.2/show-enums.html),[`SHOW TABLES`](../v20.2/show-tables.html), and [`SHOW SCHEMAS`](../v20.2/show-schemas.html). [#56325][#56325]

### API endpoint changes

- `AWS_SERVER_ENC_MODE` and `AWS_SERVER_KMS_ID` can now be specified as parameters in all s3 URIs which write to the store. This change affects both [changefeeds](../v20.2/stream-data-out-of-cockroachdb-using-changefeeds.html) and [`BACKUP`](../v20.2/backup.html)s. [#56132][#56132]

### Bug fixes

- Fixed a bug where CockroachDB would crash when executing a query via the [vectorized engine](../v20.2/vectorized-execution.html) when most of the SQL memory (determined via `--max-sql-memory` argument to [`cockroach start`](../v20.2/cockroach-start.html)) had already been reserved. [#55457][#55457]
- Fixed a very rare bug which could lead to possible write skew in distributed queries that have both zigzag joins and table readers with the zigzag joins reading keys not read by the table readers. [#55563][#55563]
- The current implementation of [changefeeds](../v20.2/stream-data-out-of-cockroachdb-using-changefeeds.html) is incompatible with the [vectorized engine](../v20.2/vectorized-execution.html). Therefore, whenever the vectorized engine was being used to run changefeeds, the command could hang indefinitely. This bug is now fixed. On 20.2 releases this could happen if the user ran `SET vectorize_row_count_threshold=0;`, and on 20.1 releases it could happen if the user ran `SET vectorize=on`. [#55753][#55753]
- Fixed a bug where CockroachDB could incorrectly evaluate the `sqrdiff` function when used as a [window function](../v20.2/window-functions.html) in some cases. [#55995][#55995]
- Fixed a bug where CockroachDB could incorrectly compute some [aggregate functions](../v20.2/functions-and-operators.html#aggregate-functions) with `DISTINCT` clauses when the query projected other columns/functions and the [vectorized engine](../v20.2/vectorized-execution.html) was used. This bug was introduced in 20.2.0.alpha.3 release. [#55872][#55872]
- Fixed a bug where CockroachDB could return incorrect results when computing the [aggregate functions](../v20.2/functions-and-operators.html#aggregate-functions) when some of the functions have `DISTINCT` clauses and some don't (the latter might not see all the necessary data). [#55872][#55872]
- Fixed a bug where the [JSON fetch value operator `->`](../v20.2/jsonb.html#operators) would evaluate incorrectly in some cases. [#55447][#55447]
- Scheduled [`BACKUP`](../v20.2/backup.html) now supports [KMS encryption](https://docs.aws.amazon.com/kms/latest/developerguide/overview.html). [#56099][#56099]
- Fixed a bug where [`IMPORT`](../v20.2/import.html)s of malformed [Avro](../v20.2/migrate-from-avro.html) records could hang forever. [#56094][#56094]
- Updated CockroachDB to avoid crashing when [`BACKUP`](../v20.2/backup.html) is unable to count the total nodes in the cluster. [#56050][#56050]
- Fixed a bug where an [`IMPORT PGDUMP`](../v20.2/migrate-from-postgres.html) with [`INSERT`](../v20.2/insert.html)s not targeting all columns in the database would panic. [#56034][#56034]
- Using the `min` or `max` [aggregate functions](../v20.2/functions-and-operators.html#aggregate-functions) in a prepared statement will now report the correct data type size. [#55622][#55622]
- Fixed an error `"top-level relational expression cannot have outer columns"` that could occur in some queries that involve a [`WITH` expression](../v20.2/common-table-expressions.html). [#56084][#56084]
- Fixed an internal error that could occur during query planning when the `use_spheroid` parameter was used in the `ST_Distance` [spatial function](../v20.2/functions-and-operators.html#spatial-functions) as part of a filter predicate. For example, `SELECT ... WHERE ST_Distance(geog1, geog2, false) < 10` previously caused an error. [#55852][#55852]
- Fixed a bug where CockroachDB previously didn't account for all the memory used by the vectorized hash aggregation which could lead to an OOM crash. [#55555][#55555]
- Fixed a bug which allowed statements after a [schema change](../v20.2/online-schema-changes.html) to fail to observe side-effects of that change on referenced tables. [#56327][#56327]
- Fixed a bug where if a [cluster backup](../v20.2/backup.html#backup-a-cluster) was taken during a [schema change](../v20.2/online-schema-changes.html), a cluster restore of that backup would create duplicates of the ongoing schema changes. [#56390][#56390]
- Fixed a bug where [dumps](../v20.2/cockroach-dump.html) of tables with a [`BIT`](../v20.2/bit.html) type column would result in an error. This column type is now supported. [#56391][#56391]
- Fixed a bug which would cause [transactions](../v20.2/transactions.html) which modified [roles](../v20.2/authorization.html#create-and-manage-roles) and then attempted to read or modify other roles would encounter blocking and stale data. [#55392][#55392]
- Fixed a bug where CockroachDB did not respect disabling [protected timestamp settings `kv.protectedts.max_bytes` and `kv.protectedts.max_spans`](../v20.2/cluster-settings.html) by setting them to zero values. [#56453][#56453]
- Fixed a panic that could occur when running [`SHOW STATISTICS USING JSON`](../v20.2/show-statistics.html) for a table in which at least one of the columns contained all _NULL_ values. [#56516][#56516]
- Fixed a hypothesized bug that could have allowed a [follower read](../v20.2/follower-reads.html) to miss data on a range in the middle of being [merged](../v20.2/range-merges.html) away into its left-hand neighbor. [#55691][#55691]
- Fixed a rare bug where when the [Pebble storage engine](../v20.2/architecture/storage-layer.html) is used with [encryption at rest](../v20.2/encryption.html), data corruption could result after a table drop, table truncate, or replica deletion. [#56678][#56678]

### Performance improvements

- Adjusted the cost model in the [optimizer](../v20.2/cost-based-optimizer.html) so that the optimizer is less likely to plan a [lookup join](../v20.2/joins.html#lookup-joins) into a virtual table. Performing a lookup join into a virtual table is expensive, so this change will generally result in better performance for queries involving joins with virtual tables. [#56349][#56349]

### Miscellaneous

#### DB Console changes

- The [diagnostics column on the Statements Page](../v20.2/ui-statements-page.html#diagnostics) has been changed and includes an `Activate` button and a dropdown list to download completed reports. Also, the diagnostics badge status is changed from `WAITING FOR QUERY` to `WAITING`. [#55890][#55890]
- Fixed an issue where the [Statement Details page](../v20.2/ui-statements-page.html#statement-details-page) didn't scroll on top when navigating from the Statements Page. [#55433][#55433]
- Loading table-level statistics on the [Databases Page](../v20.2/ui-databases-page.html) now requires a button click per-database in order to prevent contention for clusters with many databases and/or tables. In addition, the loading of table data is staggered by table instead of triggered simultaneously for all tables. [#55777][#55777]
- Added a new [cluster setting](../v20.2/cluster-settings.html) called `server.oidc_authentication.autologin` which enables an automatic redirect to the OIDC login flow instead of showing a password login prompt. A query parameter can force disable this feature in the browser by appending `?oidc_auto_login=false` to the login path. [#56510][#56510]
- Adjusted the styles for the [Session Details page](../v20.2/ui-sessions-page.html). [#55889][#55889]
- [Transaction statistics](../v20.2/ui-sql-dashboard.html#transactions) are no longer recorded if the `sql.metrics.statement_details.threshold` [cluster setting](../v20.2/cluster-settings.html) has been enabled. [#56380][#56380]
- Fixed link colors for "Back" link on the [Node Overview](../v20.2/ui-cluster-overview-page.html), [Jobs](../v20.2/ui-jobs-page.html), [Sessions](../v20.2/ui-sessions-page.html), and [Statement Details](../v20.2/ui-statements-page.html#statement-details-page) pages. [#55889][#55889]

### Contributors

This release includes 72 merged PRs by 25 authors.

We would like to thank the following contributors from the CockroachDB community:

- Max Neverov (first-time contributor)

[#54987]: https://github.com/cockroachdb/cockroach/pull/54987
[#55154]: https://github.com/cockroachdb/cockroach/pull/55154
[#55298]: https://github.com/cockroachdb/cockroach/pull/55298
[#55392]: https://github.com/cockroachdb/cockroach/pull/55392
[#55433]: https://github.com/cockroachdb/cockroach/pull/55433
[#55447]: https://github.com/cockroachdb/cockroach/pull/55447
[#55457]: https://github.com/cockroachdb/cockroach/pull/55457
[#55555]: https://github.com/cockroachdb/cockroach/pull/55555
[#55563]: https://github.com/cockroachdb/cockroach/pull/55563
[#55622]: https://github.com/cockroachdb/cockroach/pull/55622
[#55691]: https://github.com/cockroachdb/cockroach/pull/55691
[#55753]: https://github.com/cockroachdb/cockroach/pull/55753
[#55777]: https://github.com/cockroachdb/cockroach/pull/55777
[#55852]: https://github.com/cockroachdb/cockroach/pull/55852
[#55872]: https://github.com/cockroachdb/cockroach/pull/55872
[#55889]: https://github.com/cockroachdb/cockroach/pull/55889
[#55890]: https://github.com/cockroachdb/cockroach/pull/55890
[#55995]: https://github.com/cockroachdb/cockroach/pull/55995
[#56034]: https://github.com/cockroachdb/cockroach/pull/56034
[#56049]: https://github.com/cockroachdb/cockroach/pull/56049
[#56050]: https://github.com/cockroachdb/cockroach/pull/56050
[#56084]: https://github.com/cockroachdb/cockroach/pull/56084
[#56094]: https://github.com/cockroachdb/cockroach/pull/56094
[#56099]: https://github.com/cockroachdb/cockroach/pull/56099
[#56132]: https://github.com/cockroachdb/cockroach/pull/56132
[#56158]: https://github.com/cockroachdb/cockroach/pull/56158
[#56325]: https://github.com/cockroachdb/cockroach/pull/56325
[#56327]: https://github.com/cockroachdb/cockroach/pull/56327
[#56338]: https://github.com/cockroachdb/cockroach/pull/56338
[#56349]: https://github.com/cockroachdb/cockroach/pull/56349
[#56380]: https://github.com/cockroachdb/cockroach/pull/56380
[#56390]: https://github.com/cockroachdb/cockroach/pull/56390
[#56391]: https://github.com/cockroachdb/cockroach/pull/56391
[#56453]: https://github.com/cockroachdb/cockroach/pull/56453
[#56502]: https://github.com/cockroachdb/cockroach/pull/56502
[#56510]: https://github.com/cockroachdb/cockroach/pull/56510
[#56516]: https://github.com/cockroachdb/cockroach/pull/56516
[#56638]: https://github.com/cockroachdb/cockroach/pull/56638
[#56678]: https://github.com/cockroachdb/cockroach/pull/56678
